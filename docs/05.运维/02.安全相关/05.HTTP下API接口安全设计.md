---
title: HTTP和Https下API接口安全设计(3种)
date: 2021-02-26 13:31:28
permalink: /pages/a2b996/
categories:
  - 运维
  - 安全相关
tags:
  - 
---


[参考原文链接](https://www.cnblogs.com/yelanggu/p/10002481.html)

# 安全第一
## 身份认证
* 表明你是哪个应用
* 证明你是那个应用
## 权限控制
* 平台需要对自己的服务有控制权
* 用户需要对自己的数据有控制权
## 安全传输
* 防止数据包被他人篡改,伪造
* 防止非公共数据被其它人窃听 

# 易用性
## 学习成本
* "小白" 开发者很多
## 开发使用成本
* 团队成员技术领域有限
* 不是所有开发者都会用你的SDK
## 平台迁移成本
* 开发者不会忠于任何一个开发平台
## 服务开放成本
* 开放是趋势,但不是大多数团队的工作重点

# 适用性
## Web页面端
* JS跨域问题
* DELETE/PUT等操作只能通过AJAX,Flash发起
* 页面源码所有人可见
## 智能手机,平板电脑等移动设备
* 外置浏览器的体验问题,WebView的安全性问题
* 客户端无法保证密钥信息的安全存储
## 智能电视,打印机和车载设备等新型智能终端
* 用户输入支持不友好,授权流程体验差

# 性能
## 服务接入架构
* 服务域名太多带来的问题
* 穿透式架构与旁路式架构对性能的影响
## 网络协议(Https or Http)
* Https证书校验,SSL三次握手,传输层加密带来的性能消耗
* 部分移动网关不支持https
## 性能优化支持
* 外网传输速度远低于内网传输速度
* 网络处理时间远大于服务端处理耗时

# API接口调用方式(3种)
* http + 请求签名机制
* http + 参数签名机制
* https + 访问令牌机制          

# http + 请求签名机制
## 特点
* 所有携带接口信息的http头内容都必须参与签名计算
* 不同http头内容也需要按照一定规则排序
## 优点
* 真的想不到..??`作者很皮`
## 缺点
* 签名算法复杂,易用性差
* 响应包可被窃听,伪造,需要防范Replay重放攻击

# http + 参数签名机制
## 特点
* 只有GET和POST参数的内容需要参与签名计算
## 优点
* 签名算法相对简单,易用性有较大提升 
## 缺点
* 响应包可被窃听,伪造,需要防范Replay重放攻击


# https + 访问令牌机制(当下最流行) 
## 特点
* 无需签名计算
* 依靠传输层加密和访问令牌的不可伪造性保证安全
## 优点
* 相对安全,无法通过网络抓包方式窃听或伪造数据
* 易用性高,无需要再为签名头疼,无需考虑Replay重放攻击
## 缺点
* 安全性建立在用户不被中间人攻击和令牌不被泄漏的基础之上 `https中间人攻击见(有些软件模拟处理):HTTPS中间人攻击实践（原理·实践） `  


# 有没有更好的方案
## 牺牲易用性换取安全性
* https + 内容签名机制
* https + 内容加密机制
## 降低令牌泄漏带来的风险
* 为开发者提供绑定服务器IP列表,限制Refer等支持 
* 针对不同应用场景颁发不同有效期的访问令牌
* 针对不同安全级别的数据授权办法不同有效期的访问令牌
* 为开发者和用户提供令牌作废支持


# OAuth2.0服务的几种授权流程
## 标准授权流程(RFC6749)
* 服务端流程
* 客户端流程
* 用户名密码流程
* 客户端凭证流程
* 令牌刷新流程
## 扩展授权流程
* 开发者凭证流程
* 登录session凭证流程
* 设备授权流程



* rfc文档如何查阅(以stun协议为例)
  * https://www.rfc-editor.org/info/rfc3489   (查看rfc文状态)
  * 看文档是不是被新的rfc取代了
  * 点击txt,pdf查看内容 ()