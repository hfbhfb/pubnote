---
title: go一份面试题
date: 2020-12-05 18:17:52
permalink: /pages/1086cc/
categories:
  - 后端
  - golang
tags:
  - 
---


## 知识点
*  导入包init先后顺序
*  同步锁与goroutine
*  Json不能处理哪些结构体(指针是有效的) 
*  panic与defer 先panic
*  map[string]int 零值判断
*  map需要make才能用
*  close的channel往里写会panic
*  一个写法String函数的无限循环




## 代码如下

/Users/hfb/projects/go/gopath/src_only_mod_copy/gopl.io/ch0interview/oneinterview/pack/pack1.go
``` go
package packt

import "fmt"

func init() {
	fmt.Println("init pack1")
}

```

/Users/hfb/projects/go/gopath/src_only_mod_copy/gopl.io/ch0interview/chat01/main01.go
``` go
// main.go
package main

import (
	"encoding/json"
	"fmt"
	_ "gopl.io/ch0interview/oneinterview/pack"
	"log"
	"sync"
	"time"
)

type K1 struct {
	Name string
}

type Memo struct {
	mu sync.Mutex // guards cache
}

func main() {
	//testlockingorouting()
	//testJson()
	//testPackinit()
	//testPanicdefer()
	//testMapintNilCheck()
	//testNoinitMap()
	//testCloseChan()

	testStructStringLoop()

}

type People struct {
	Name string
}

func (p *People) String() string {
	return fmt.Sprintf("print:%v", p)

}
func testStructStringLoop() {
	p := &People{}
	p.String()

}

func testCloseChan() {
	ch := make(chan int, 10000)
	go func() {
		for i := 0; i < 10; i++ {
			ch <- i
		}
	}()
	go func() {
		for {
			a, ok := <-ch
			if !ok {
				fmt.Println("close")
				return
			}
			fmt.Println("a:", a)
		}
	}()

	close(ch)
	fmt.Println("ok")
	time.Sleep(time.Second)
	time.Sleep(time.Second)
	time.Sleep(time.Second)

}

func testNoinitMap() {
	type MyMap map[string]interface{}
	type Data struct {
		MyMap
	}
	v1 := new(Data)
	v1.MyMap["RMB"] = 5
}

func testMapintNilCheck() {
	mapi := make(map[string]int)
	mapi["a"] = 1
	if v := mapi["b"]; v == 0 {
		fmt.Println("v is null")
	}

}

func testPanicdefer() {
	defer fmt.Println("aaa")
	defer fmt.Println("bbb")
	defer fmt.Println("ccc")
	panic("panic print")
}

func testPackinit() {
	// 看包含的默认包
}

func init() {
	fmt.Printf("%s\n", "init main")
}

type Func func(key string)

func testJson() {
	i := 1
	movies := struct {
		P    *int
		Ch1  chan int  `json:"-"`
		Comp complex64 `json:"-"`
		F    Func      `json:"-"`
		S1   string
	}{
		&i,
		make(chan int),
		3,
		func(key string) {
			return
		},
		"dsfklsdfj",
	}

	fmt.Println(movies)
	data, err := json.Marshal(movies)
	if err != nil {
		log.Fatalf("JSON marshaling failed: %s", err)
	}
	fmt.Printf("%s\n", data)

}

func testlockingorouting() { // 锁不是只能在一个goroutine中用的
	m1 := new(Memo)
	m1.mu.Lock()
	go func() {
		time.Sleep(time.Second)
		time.Sleep(time.Second)
		m1.mu.Unlock()
	}()
	fmt.Println(fmt.Sprintf("abc%v", 3))

	m1.mu.Lock()
	fmt.Println(fmt.Sprintf("abc%v", 3))
	fmt.Println(fmt.Sprintf("abc%v", 3))
	fmt.Println(fmt.Sprintf("abc%v", 3))

	time.Sleep(time.Second)
	time.Sleep(time.Second)
	time.Sleep(time.Second)
}

```