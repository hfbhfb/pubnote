---
title: 操作系统之进程和线程
date: 2021-03-24 06:29:24
permalink: /pages/614408/
categories:
  - 后端
  - 操作系统
tags:
  - 
---

## 上下文切换： 是指CPU从一个进程（或线程）切换到另一个进程（或线程），涉及到控制权的转移。
* 保存当前进程的上下文
* 选择某个进程，恢复其上一次换出时保存的上下文
* 当前进程将控制权转移给新恢复的进程

进程由程序代码、数据、进程控制块（Process Control Block, `PCB`）三个部分组成

## task_struct是Linux中的PCB，进程上下切换时需要保存task_struct中的内容。包含以下内容：


* 线程的切换： 线程共享进程的资源，进行线程切换时，只需要保存线程的私有数据：栈、程序计数器、寄存器
* 进程切换的开销比线程切换的开销大：
* 显式原因： 进程的上下文切换需要保存更多的信息，比线程的上下文切换开销更大。
* 隐式原因： 进程切换时使用不同资源的task_struct之间的调度，而线程切换是使用相同资源的task_struct之间的调度。进程切换使得原有的缓存不适用，会触发缺页中断；而线程切换时，由于使用相同资源，缓存的命中率更高很多。
* Linux中使用TLB（Translation Lookaside Buffer，转换检测缓冲）来管理虚拟内存到物理内存的映射关系。虚拟内存更新后，TLB也需要刷新，`内存的访问会随之变慢`。


## 进程终止的原因：
* 正常结束： exit、halt、logoff。
* 异常结束： 无可用内存、越界、保护错误、算术错误、I/O失败、无效指令、特权指令等
* 外界干预： kill进程、父进程终止（父进程终止，其子进程可能被系统终止）、父进程请求（父进程可以请求终止子进程）。

## 进程终止的过程：
* 检索PCB，检查进程状态
* 将进程从运行态转换成终止态
* 检查是否有子进程需要终止
* 将获取到的资源归还给父进程或系统
* 将该进程的PCB从PCB队列中移出


[原文链接](https://blog.csdn.net/u014454538/article/details/99330919)

