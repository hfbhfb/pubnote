---
title: 粗线条话GC（一）
date: 2021-04-01 00:33:02
permalink: /pages/7bfd31/
categories:
  - 操作系统级与go进阶
  - golang进阶Eggo
tags:
  - 
---



* 分配在堆上的数据 
* "悬挂指针"问题
* <img src="./minilet/image-20210401122138490.png" alt="image-20210401122138490" style="zoom:50%;" />
* 越来越多语言=>自动垃圾回收   
* 主流垃圾回收算法 : `可达性` 近似 `存活性`
* <img src="./minilet/image-20210401134257659.png" alt="image-20210401134257659" style="zoom:50%;" />

* 三色抽象算法  `堆区` `栈区`  25%cpu目标消耗 
* <img src="./minilet/image-20210401134929810.png" alt="image-20210401134929810" style="zoom:50%;" />
* 步骤1: root能标记到的节点为灰色 `灰色:当前节点展开的追踪还未完成`
* <img src="./minilet/image-20210401143127923.png" alt="image-20210401143127923" style="zoom:50%;" />
* 步骤2:   把已完成的追踪标记为黑色  `黑色:已完成,无需再基于它再次进行追踪`
* <img src="./minilet/image-20210401143638671.png" alt="image-20210401143638671" style="zoom:50%;" />

* 步骤3: 当不存在灰色节点时,标记工作可以结束了
* 步骤4:白色节点为垃圾可以回收
* <img src="./minilet/image-20210401144032507.png" alt="image-20210401144032507" style="zoom:50%;" />

*   内存碎片化问题? 
* 方案1:如何解决  `bibop(Big Bag Of Pages)`
* <img src="./minilet/image-20210401154132892.png" alt="image-20210401154132892" style="zoom:50%;" />

* 方案2:   `标记压缩`  `复制式回收`
* <img src="./minilet/image-20210401154412618.png" alt="image-20210401154412618" style="zoom:50%;" />

* 方案3:分代回收 : 一种复制式回收的优化
* <img src="./minilet/image-20210401155018820.png" alt="image-20210401155018820" style="zoom:50%;" />

* 引用记数垃级回收
* 垃圾回收优化:  STW: stop the world   `防止性能抖动`
* `三色:垃圾回收 读写屏障`  实现 强/弱三色不变式的通常做法
* <img src="./minilet/image-20210401155446258.png" alt="image-20210401155446258" style="zoom:50%;" />

* 什么是写屏障? `写操作中插入指令`  具体实现有一个记录集
* ![./image-20210401155612898](minilet/image-20210401155612898.png)

* 读写屏障混用
* <img src="./minilet/image-20210401164946919.png" alt="image-20210401164946919" style="zoom:50%;" />

* `并发垃圾回收`  `主体并发式回收` `主体并发增量式`
* <img src="./minilet/image-20210401165427243.png" alt="image-20210401165427243" style="zoom:50%;" />

* 概括:    `概念`  `算法核心思想`  `运行模式`



* Go语言采用的是  `标记-清扫算法` `主体并发增量式` `插入与删除的混合写屏障`
* <img src="./minilet/image-20210401165637914.png" alt="image-20210401165637914" style="zoom:50%;" />



[图片来源视频](https://www.bilibili.com/video/BV1n5411H7qS)

